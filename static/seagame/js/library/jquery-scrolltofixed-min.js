define(["jquery"],function(d){d.isScrollToFixed=function(e){return!!d(e).data("ScrollToFixed")};d.ScrollToFixed=function(e,G){function A(){var c=b.options.limit;return c?"function"===typeof c?c.apply(a):c:0}function p(){return"fixed"===g}function n(){return!(p()||"absolute"===g)}function w(){p()||(f.css({display:a.css("display"),width:a.outerWidth(!0),height:a.outerHeight(!0),"float":a.css("float")}),cssOptions={"z-index":b.options.zIndex,position:"fixed",top:-1==b.options.bottom?r():"",bottom:-1==
    b.options.bottom?"":b.options.bottom,"margin-left":"0px"},b.options.dontSetWidth||(cssOptions.width=a.width()),a.css(cssOptions),a.addClass(b.options.baseClassName),b.options.className&&a.addClass(b.options.className),g="fixed")}function B(){var c=A(),d=k;b.options.removeOffsets&&(d="",c-=t);cssOptions={position:"absolute",top:c,left:d,"margin-left":"0px",bottom:""};b.options.dontSetWidth||(cssOptions.width=a.width());a.css(cssOptions);g="absolute"}function l(){n()||(q=-1,f.css("display","none"),
    a.css({"z-index":C,width:"",position:x,left:"",top:D,"margin-left":""}),a.removeClass("scroll-to-fixed-fixed"),b.options.className&&a.removeClass(b.options.className),g=null)}function y(b){b!=q&&(a.css("left",k-b),q=b)}function r(){var c=b.options.marginTop;return c?"function"===typeof c?c.apply(a):c:0}function u(){if(d.isScrollToFixed(a)){var c=v;v?n()&&(t=a.offset().top,k=a.offset().left):(a.trigger("preUnfixed.ScrollToFixed"),l(),a.trigger("unfixed.ScrollToFixed"),q=-1,t=a.offset().top,k=a.offset().left,
    b.options.offsets&&(k+=a.offset().left-a.position().left),-1==E&&(E=k),g=a.css("position"),v=!0,-1!=b.options.bottom&&(a.trigger("preFixed.ScrollToFixed"),w(),a.trigger("fixed.ScrollToFixed")));var f=d(window).scrollLeft(),h=d(window).scrollTop(),e=A();b.options.minWidth&&d(window).width()<b.options.minWidth?n()&&c||(m(),a.trigger("preUnfixed.ScrollToFixed"),l(),a.trigger("unfixed.ScrollToFixed")):b.options.maxWidth&&d(window).width()>b.options.maxWidth?n()&&c||(m(),a.trigger("preUnfixed.ScrollToFixed"),
    l(),a.trigger("unfixed.ScrollToFixed")):-1==b.options.bottom?0<e&&h>=e-r()?"absolute"===g&&c||(m(),a.trigger("preAbsolute.ScrollToFixed"),B(),a.trigger("unfixed.ScrollToFixed")):h>=t-r()?(p()&&c||(m(),a.trigger("preFixed.ScrollToFixed"),w(),q=-1,a.trigger("fixed.ScrollToFixed")),y(f)):n()&&c||(m(),a.trigger("preUnfixed.ScrollToFixed"),l(),a.trigger("unfixed.ScrollToFixed")):0<e?(c=h+d(window).height()-a.outerHeight(!0),(h=r())||(h=b.options.bottom?b.options.bottom:0,h=-h),c>=e-h?p()&&(m(),a.trigger("preUnfixed.ScrollToFixed"),
    "absolute"===x?B():l(),a.trigger("unfixed.ScrollToFixed")):(p()||(m(),a.trigger("preFixed.ScrollToFixed"),w()),y(f),a.trigger("fixed.ScrollToFixed"))):y(f)}}function m(){var b=a.css("position");"absolute"==b?a.trigger("postAbsolute.ScrollToFixed"):"fixed"==b?a.trigger("postFixed.ScrollToFixed"):a.trigger("postUnfixed.ScrollToFixed")}var b=this;b.$el=d(e);b.el=e;b.$el.data("ScrollToFixed",b);var v=!1,a=b.$el,g,x,D,C,t=0,k=0,E=-1,q=-1,f=null,z=function(b){a.is(":visible")&&(v=!1,u())},F=function(a){window.requestAnimationFrame?
    requestAnimationFrame(u):u()};b.init=function(){b.options=d.extend({},d.ScrollToFixed.defaultOptions,G);C=a.css("z-index");b.$el.css("z-index",b.options.zIndex);f=d("<div />");g=a.css("position");x=a.css("position");D=a.css("top");n()&&b.$el.after(f);d(window).bind("resize.ScrollToFixed",z);d(window).bind("scroll.ScrollToFixed",F);b.options.preFixed&&a.bind("preFixed.ScrollToFixed",b.options.preFixed);b.options.postFixed&&a.bind("postFixed.ScrollToFixed",b.options.postFixed);b.options.preUnfixed&&
a.bind("preUnfixed.ScrollToFixed",b.options.preUnfixed);b.options.postUnfixed&&a.bind("postUnfixed.ScrollToFixed",b.options.postUnfixed);b.options.preAbsolute&&a.bind("preAbsolute.ScrollToFixed",b.options.preAbsolute);b.options.postAbsolute&&a.bind("postAbsolute.ScrollToFixed",b.options.postAbsolute);b.options.fixed&&a.bind("fixed.ScrollToFixed",b.options.fixed);b.options.unfixed&&a.bind("unfixed.ScrollToFixed",b.options.unfixed);b.options.spacerClass&&f.addClass(b.options.spacerClass);a.bind("resize.ScrollToFixed",
    function(){f.height(a.height())});a.bind("scroll.ScrollToFixed",function(){a.trigger("preUnfixed.ScrollToFixed");l();a.trigger("unfixed.ScrollToFixed");u()});a.bind("detach.ScrollToFixed",function(c){c=c||window.event;c.preventDefault&&c.preventDefault();c.returnValue=!1;a.trigger("preUnfixed.ScrollToFixed");l();a.trigger("unfixed.ScrollToFixed");d(window).unbind("resize.ScrollToFixed",z);d(window).unbind("scroll.ScrollToFixed",F);a.unbind(".ScrollToFixed");f.remove();b.$el.removeData("ScrollToFixed")});
    z()};b.init()};d.ScrollToFixed.defaultOptions={marginTop:0,limit:0,bottom:-1,zIndex:1E3,baseClassName:"scroll-to-fixed-fixed"};d.fn.scrollToFixed=function(e){return this.each(function(){new d.ScrollToFixed(this,e)})}});
